p15()
p15 <- function(don){
conteos<- lapply(don,function(c){
xtabs(~c,data=elektra)
})
aux<-data.frame()
aux2<-lapply(conteos,function(l){
n<-length(l)
rbind(aux,data.frame(linea=names(l),valor=as.numeric(l[1:n])))
})
aux3<-Reduce('rbind',aux2) %>%
filter(linea !=" ") %>%
group_by(linea) %>%
summarise(valor=sum(valor)) %>%
mutate(p_valor=valor/nrow(base_im)) %>%
data.frame() %>%
arrange(desc(p_valor))
gy <- data.frame(do.call(cbind,lapply(don,p15)))
gh <- gy[,c(1,3,6,9,12,15,18)]
colnames(gh) <-c("Medio","Elektra","Coppel","Famsa","Bodega Aurrera","Walmart","Liverpool")
aux <- gather(gh,"Tienda","Valor",-Medio)
return(aux)
}
p15(marcas)
don<-marcas
conteos<- lapply(don,function(c){
xtabs(~c,data=elektra)
})
don
p15 <- function(don){
conteos<- lapply(don,function(c){
xtabs(~c,data=elektra)
})
aux<-data.frame()
aux2<-lapply(conteos,function(l){
n<-length(l)
rbind(aux,data.frame(linea=names(l),valor=as.numeric(l[1:n])))
})
aux3<-Reduce('rbind',aux2) %>%
filter(linea !=" ") %>%
group_by(linea) %>%
summarise(valor=sum(valor)) %>%
mutate(Porcentaje=valor/nrow(base_im)) %>%
data.frame() %>%
arrange(desc(p_valor))
return(gh)
}
marcas[[1]]
don<-marcas[[1]]
conteos<- lapply(don,function(c){
xtabs(~c,data=elektra)
})
aux<-data.frame()
aux2<-lapply(conteos,function(l){
n<-length(l)
rbind(aux,data.frame(linea=names(l),valor=as.numeric(l[1:n])))
})
aux3<-Reduce('rbind',aux2) %>%
filter(linea !=" ") %>%
group_by(linea) %>%
summarise(valor=sum(valor)) %>%
mutate(Porcentaje=valor/nrow(base_im)) %>%
data.frame() %>%
arrange(desc(p_valor))
aux3<-Reduce('rbind',aux2) %>%
filter(linea !=" ") %>%
group_by(linea) %>%
summarise(valor=sum(valor)) %>%
mutate(Porcentaje=valor/nrow(base_im)) %>%
data.frame() %>%
arrange(desc(Porcentaje))
aux3
p15 <- function(don){
conteos<- lapply(don,function(c){
xtabs(~c,data=elektra)
})
aux<-data.frame()
aux2<-lapply(conteos,function(l){
n<-length(l)
rbind(aux,data.frame(linea=names(l),valor=as.numeric(l[1:n])))
})
aux3<-Reduce('rbind',aux2) %>%
filter(linea !=" ") %>%
group_by(linea) %>%
summarise(valor=sum(valor)) %>%
mutate(Porcentaje=valor/nrow(base_im)) %>%
data.frame() %>%
arrange(desc(Porcentaje))
return(gh)
}
funp15<-function(){
gy <- data.frame(do.call(cbind,lapply(marcas,p15)))
gh <- gy[,c(1,3,6,9,12,15,18)]
colnames(gh) <-c("Medio","Elektra","Coppel","Famsa","Bodega Aurrera","Walmart","Liverpool")
gather(gh,"Tienda","Porcentaje")
}
funp15()
gy <- data.frame(do.call(cbind,lapply(marcas,p15)))
gh <- gy[,c(1,3,6,9,12,15,18)]
colnames(gh) <-c("Medio","Elektra","Coppel","Famsa","Bodega Aurrera","Walmart","Liverpool")
View(gh)
gather(gh,"Tienda","Porcentaje",-Medio)
View(gh)
gy <- data.frame(do.call(cbind,lapply(marcas,p15)))
gh <- gy[,c(1,3,6,9,12,15,18)]
colnames(gh) <-c("Medio","Elektra","Coppel","Famsa","Bodega Aurrera","Walmart","Liverpool")
View(gh)
View(gy)
marcas <- list(
elektra <- base_evap[,c(6:17)],
Coppel <- base_evap[,c(19:30)],
Famsa <- base_evap[,c(32:43)],
Bodega <- base_evap[,c(45:56)],
Walmart <- base_evap[,c(58:69)],
Liver <- base_evap[,c(71:82)])
gy <- data.frame(do.call(cbind,lapply(marcas,p15)))
View(gy)
View(elektra)
p15 <- function(don){
conteos<- lapply(don,function(c){
xtabs(~c,data=don)
})
aux<-data.frame()
aux2<-lapply(conteos,function(l){
n<-length(l)
rbind(aux,data.frame(linea=names(l),valor=as.numeric(l[1:n])))
})
aux3<-Reduce('rbind',aux2) %>%
filter(linea !=" ") %>%
group_by(linea) %>%
summarise(valor=sum(valor)) %>%
mutate(Porcentaje=valor/nrow(base_im)) %>%
data.frame() %>%
arrange(desc(Porcentaje))
return(gh)
}
gy <- data.frame(do.call(cbind,lapply(marcas,p15)))
View(gy)
p15 <- function(don){
conteos<- lapply(don,function(c){
xtabs(~c,data=don)
})
aux<-data.frame()
aux2<-lapply(conteos,function(l){
n<-length(l)
rbind(aux,data.frame(linea=names(l),valor=as.numeric(l[1:n])))
})
aux3<-Reduce('rbind',aux2) %>%
filter(linea !=" ") %>%
group_by(linea) %>%
summarise(valor=sum(valor)) %>%
mutate(Porcentaje=valor/nrow(base_im)) %>%
data.frame() %>%
arrange(desc(Porcentaje))
return(aux3)
}
gy <- data.frame(do.call(cbind,lapply(marcas,p15)))
View(gy)
gh <- gy[,c(1,3,6,9,12,15,18)]
colnames(gh) <-c("Medio","Elektra","Coppel","Famsa","Bodega Aurrera","Walmart","Liverpool")
View(gh)
gather(gh,"Tienda","Porcentaje",-Medio)
funp15<-function(){
gy <- data.frame(do.call(cbind,lapply(marcas,p15)))
gh <- gy[,c(1,3,6,9,12,15,18)]
colnames(gh) <-c("Medio","Elektra","Coppel","Famsa","Bodega Aurrera","Walmart","Liverpool")
aux<-gather(gh,"Tienda","Porcentaje",-Medio)
return(aux)
}
funp15()
cuenta<-function(datos,ru){
if(ru==1){
Top <- cbind(prop.table((table(datos)))*100) %>%
data.frame()
colnames(Top) <- c("Porcentaje")
Top <- cbind(linea= rownames(Top),Top)
return(Top)
}
if(ru ==2){
conteos<- apply(datos,2,function(c){
xtabs(~c,data=datos)
})
aux<-data.frame()
aux2<-lapply(conteos,function(l){
n<-length(l)
rbind(aux,data.frame(linea=names(l),valor=as.numeric(l[1:n])))
})
aux3<-Reduce('rbind',aux2) %>%
filter(linea !=" ") %>%
group_by(linea) %>%
mutate(Porcentaje=valor/nrow(base_con)) %>%
data.frame() %>%
arrange(desc(Porcentaje))
return(aux3)
}
}
cuenta(base_con[,95:104],2)
lapply(frases,gd)
p14(preg)
attri(base_evap[,c(115:128)])
attri <- function(base){
conteos<- t(sapply(base,function(c){
xtabs(~c,data=base)
}))
conteos <- data.frame(conteos[,2:4])
conteos$total <- apply(conteos,1,sum)
conteos$Concuerda_completamente <- conteos[,1]/conteos[,4]
conteos$Concuerda_en_parte <- conteos[,2]/conteos[,4]
conteos$Concuerda_en_nada <- conteos[,3]/conteos[,4]
conteos <- cbind(atributo = rownames(conteos), conteos)
atributos <- conteos[,c(1,6)]
return(atributos)
}
attri(base_evap[,c(115:128)])
attri(base_evap[,c(115:128)])
attri <- function(base){
conteos<- t(sapply(base,function(c){
xtabs(~c,data=base)
}))
conteos <- data.frame(conteos[,2:4])
conteos$total <- apply(conteos,1,sum)
conteos$Concuerda_completamente <- conteos[,1]/conteos[,4]
conteos$Concuerda_en_parte <- conteos[,2]/conteos[,4]
conteos$Concuerda_en_nada <- conteos[,3]/conteos[,4]
conteos <- cbind(atributo = rownames(conteos), conteos)
atributos <- conteos[,c(1,6)]
return(atributos)
}
attri(base_evap[,c(115:128)])
View(base_evap)
names(base_evap)
View(base_evap[,115:128])
df<-base_evap[,c(115:128)]
conteos<- t(sapply(df,function(c){
xtabs(~c,data=df)
}))
conteos
conteos <- data.frame(conteos)
attri <- function(df){
conteos<- t(sapply(df,function(c){
xtabs(~c,data=df)
}))
conteos <- data.frame(conteos)
conteos$total <- apply(conteos,1,sum)
conteos$Concuerda_completamente <- conteos[,1]/conteos[,4]
conteos$Concuerda_en_parte <- conteos[,2]/conteos[,4]
conteos$Concuerda_en_nada <- conteos[,3]/conteos[,4]
conteos <- cbind(atributo = rownames(conteos), conteos)
atributos <- conteos[,c(1,6)]
return(atributos)
}
attri(base_evap[,c(115:128)])
attri <- function(df){
conteos<- t(sapply(df,function(c){
xtabs(~c,data=df)
}))
conteos <- data.frame(conteos)
conteos$total <- apply(conteos,1,sum)
conteos$Concuerda_completamente <- conteos[,1]/conteos[,4]
conteos$Concuerda_en_parte <- conteos[,2]/conteos[,4]
conteos$Concuerda_en_nada <- conteos[,3]/conteos[,4]
conteos <- cbind(atributo = rownames(conteos), conteos)
return(conteos)
}
attri(base_evap[,c(115:128)])
aux<-gather(conteos,"Concuerda","Valor")
#atributos de spots----
attri <- function(df){
conteos<- t(sapply(df,function(c){
xtabs(~c,data=df)
}))
conteos <- data.frame(conteos)
conteos$total <- apply(conteos,1,sum)
conteos$Concuerda_completamente <- conteos[,1]/conteos[,4]
conteos$Concuerda_en_parte <- conteos[,2]/conteos[,4]
conteos$Concuerda_en_nada <- conteos[,3]/conteos[,4]
conteos <- cbind(atributo = rownames(conteos), conteos)
aux<-gather(conteos,"Concuerda","Valor")
return(conteos)
}
attri(base_evap[,c(115:128)])
conteos<- t(sapply(df,function(c){
xtabs(~c,data=df)
}))
conteos <- data.frame(conteos)
conteos$total <- apply(conteos,1,sum)
conteos$Concuerda_completamente <- conteos[,1]/conteos[,4]
conteos$Concuerda_en_parte <- conteos[,2]/conteos[,4]
conteos$Concuerda_en_nada <- conteos[,3]/conteos[,4]
conteos <- cbind(atributo = rownames(conteos), conteos)
View(conteos)
aux<-gather(conteos,"Concuerda","Valor",-atributo)
View(aux)
attri <- function(df){
conteos<- t(sapply(df,function(c){
xtabs(~c,data=df)
}))
conteos <- data.frame(conteos)
conteos$total <- apply(conteos,1,sum)
conteos$Concuerda_completamente <- conteos[,1]/conteos[,4]
conteos$Concuerda_en_parte <- conteos[,2]/conteos[,4]
conteos$Concuerda_en_nada <- conteos[,3]/conteos[,4]
conteos <- cbind(atributo = rownames(conteos), conteos)
aux<-gather(conteos,"Concuerda","Valor",-atributo)
return(conteos)
}
shiny::runApp('~/Box Sync/Trabajo2/happy index/aplicaciÃ³n')
base_con<-readRDS("data/base_con.rds")
base_im<-readRDS("data/base_im.rds")
base_eq <- readRDS("data/base_eq.rds")
base_evap <- readRDS("data/base_evap.rds")
frases <- list(a1 = base_im[,c(6:9)],
b2 = base_im[,c(12:17)],
c3 = base_im[,c(18:23)],
d4 = base_im[,c(24:29)],
e5 = base_im[,c(30:35)],
f6 = base_im[,c(36:40)],
g7 = base_im[,c(42:46)],
h8 = base_im[,c(48:53)],
i9 = base_im[,c(54:59)],
j10 = base_im[,c(60:65)],
k11 = base_im[,c(66:71)],
l12 = base_im[,c(72:77)],
m13 = base_im[,c(78:83)],
n14 = base_im[,c(84:89)],
nn15 = base_im[,c(90:95)],
o16 = base_im[,c(96:100)],
p17 = base_im[,c(102:106)],
q18 = base_im[,c(108:113)],
r19 = base_im[,c(114:119)],
s20 = base_im[,c(120:125)],
s21 = base_im[,c(126:131)],
s22 = base_im[,c(132:137)],
s23 = base_im[,c(138:143)])
marcas <- list(
elektra <- base_evap[,c(6:17)],
Coppel <- base_evap[,c(19:30)],
Famsa <- base_evap[,c(32:43)],
Bodega <- base_evap[,c(45:56)],
Walmart <- base_evap[,c(58:69)],
Liver <- base_evap[,c(71:82)])
atri <- (base_evap[,c(115:128)])
cuenta(base_con[,95:104],2)
cuenta<-function(datos,ru){
if(ru==1){
Top <- cbind(prop.table((table(datos)))*100) %>%
data.frame()
colnames(Top) <- c("Porcentaje")
Top <- cbind(linea= rownames(Top),Top)
return(Top)
}
if(ru ==2){
conteos<- apply(datos,2,function(c){
xtabs(~c,data=datos)
})
aux<-data.frame()
aux2<-lapply(conteos,function(l){
n<-length(l)
rbind(aux,data.frame(linea=names(l),valor=as.numeric(l[1:n])))
})
aux3<-Reduce('rbind',aux2) %>%
filter(linea !=" ") %>%
group_by(linea) %>%
mutate(Porcentaje=valor/nrow(base_con)) %>%
data.frame() %>%
arrange(desc(Porcentaje))
return(aux3)
}
}
cuenta(base_con[,95:104],2)
gd <- function (mr){
conteos<- apply(mr,2,function(c){
xtabs(~c,data=mr)
})
aux<-data.frame()
aux2<-lapply(conteos,function(l){
n<-length(l)
rbind(aux,data.frame(linea=names(l),valor=as.numeric(l[1:n])))
})
aux3<-Reduce('rbind',aux2) %>%
filter(linea !=" ") %>%
group_by(linea) %>%
summarise(valor=sum(valor)) %>%
mutate(Porcentaje=valor/nrow(base_im)) %>%
data.frame() %>%
arrange(desc(p_valor))
return(aux3)
}
gy <- lapply(frases,gd)
gd <- function (mr){
conteos<- apply(mr,2,function(c){
xtabs(~c,data=mr)
})
aux<-data.frame()
aux2<-lapply(conteos,function(l){
n<-length(l)
rbind(aux,data.frame(linea=names(l),valor=as.numeric(l[1:n])))
})
aux3<-Reduce('rbind',aux2) %>%
filter(linea !=" ") %>%
group_by(linea) %>%
summarise(valor=sum(valor)) %>%
mutate(Porcentaje=valor/nrow(base_im)) %>%
data.frame() %>%
arrange(desc(Porcentaje))
return(aux3)
}
gy <- lapply(frases,gd)
mr<-frases[[1]]
gd(mr)
hj <- function(mr){
prob <- (prop.table((table(mr)))*100)
}
p14 <- function(data){
gr <- data.frame(do.call(cbind,lapply(preg,hj)))
gr <- cbind(atributo= rownames(gr),gr)
return(gr)
}
preg <-base_eq[,c(42:47)]
p14(preg)
p14 <- function(data){
gr <- data.frame(do.call(cbind,lapply(data,hj)))
gr <- cbind(atributo= rownames(gr),gr)
aux<-gather(gr,"Tienda","Valor",-atributo)
aux$Tienda <- apply(as.data.frame(aux$Tienda),2,function(r){gsub("P14_","",r)})
return(aux)
}
p14(preg)
p15 <- function(don){
conteos<- lapply(don,function(c){
xtabs(~c,data=don)
})
aux<-data.frame()
aux2<-lapply(conteos,function(l){
n<-length(l)
rbind(aux,data.frame(linea=names(l),valor=as.numeric(l[1:n])))
})
aux3<-Reduce('rbind',aux2) %>%
filter(linea !=" ") %>%
group_by(linea) %>%
summarise(valor=sum(valor)) %>%
mutate(Porcentaje=valor/nrow(base_im)) %>%
data.frame() %>%
arrange(desc(Porcentaje))
return(aux3)
}
funp15<-function(){
gy <- data.frame(do.call(cbind,lapply(marcas,p15)))
gh <- gy[,c(1,3,6,9,12,15,18)]
colnames(gh) <-c("Medio","Elektra","Coppel","Famsa","Bodega Aurrera","Walmart","Liverpool")
aux<-gather(gh,"Tienda","Porcentaje",-Medio)
return(aux)
}
funp15()
attri <- function(df){
conteos<- t(sapply(df,function(c){
xtabs(~c,data=df)
}))
conteos <- data.frame(conteos)
conteos$total <- apply(conteos,1,sum)
conteos$Concuerda_completamente <- conteos[,1]/conteos[,4]
conteos$Concuerda_en_parte <- conteos[,2]/conteos[,4]
conteos$Concuerda_en_nada <- conteos[,3]/conteos[,4]
conteos <- cbind(atributo = rownames(conteos), conteos)
aux<-gather(conteos,"Concuerda","Valor",-atributo)
return(conteos)
}
attri(base_evap[,c(115:128)])
attri
attri(base_evap[,c(115:128)])
attri <- function(df){
conteos<- t(sapply(df,function(c){
xtabs(~c,data=df)
}))
conteos <- data.frame(conteos)
conteos$total <- apply(conteos,1,sum)
conteos$Concuerda_completamente <- conteos[,1]/conteos[,4]
conteos$Concuerda_en_parte <- conteos[,2]/conteos[,4]
conteos$Concuerda_en_nada <- conteos[,3]/conteos[,4]
conteos <- cbind(atributo = rownames(conteos), conteos)
aux<-gather(conteos,"Concuerda","Valor",-atributo)
return(aux)
}
attri(base_evap[,c(115:128)])
eval<-function(datos,ru){
if(ru==1){
Top <- cbind(prop.table((table(datos)))*100) %>%
data.frame()
colnames(Top) <- c("Porcentaje")
Top <- cbind(linea= rownames(Top),Top)
return(Top)
}
if(ru ==2){
conteos<- apply(datos,2,function(c){
xtabs(~c,data=datos)
})
aux<-data.frame()
aux2<-lapply(conteos,function(l){
n<-length(l)
rbind(aux,data.frame(linea=names(l),valor=as.numeric(l[1:n])))
})
aux3<-Reduce('rbind',aux2) %>%
filter(linea !=" ") %>%
group_by(linea) %>%
summarise(valor=sum(valor)) %>%
mutate(Porcentaje=valor/nrow(base_con)) %>%
data.frame() %>%
arrange(desc(Porcentaje))
return(aux3)
}
}
eval(base_evap[,131],1)
